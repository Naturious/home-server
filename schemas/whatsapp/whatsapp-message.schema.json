{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://naturious-home/schemas/whatsapp-message.json",
  "title": "WhatsAppMessage",
  "description": "Schema for a WhatsApp message flowing into Kafka.",
  "type": "object",

  "properties": {
    "id": {
      "type": "string",
      "description": "A unique message ID generated by WhatsApp or by your ingestion system."
    },

    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp when the message was sent."
    },

    "sender": {
      "type": "object",
      "description": "Information about the message sender.",
      "properties": {
        "phone": {
          "type": "string",
          "description": "E.164 formatted phone number (+316...)."
        },
        "name": {
          "type": "string",
          "description": "Display name of the sender (optional)."
        },
        "is_me": {
          "type": "boolean",
          "description": "True if the message was sent by the owner of the WhatsApp account."
        }
      },
      "required": ["phone"]
    },

    "chat": {
      "type": "object",
      "description": "Information about the chat the message belongs to.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique chat/thread ID."
        },
        "type": {
          "type": "string",
          "enum": ["private", "group"],
          "description": "Whether this message is in a private chat or a group."
        },
        "name": {
          "type": "string",
          "description": "Chat or group name."
        },
        "participants": {
          "type": "array",
          "description": "List of participants (for group chats).",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["id", "type"]
    },

    "content": {
      "type": "object",
      "description": "Message content, which can be text or media.",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["text", "image", "video", "audio", "file", "sticker", "location", "contact"],
          "description": "Type of message content."
        },

        "text": {
          "type": "string",
          "description": "Raw text if this is a text message."
        },

        "media_url": {
          "type": "string",
          "format": "uri",
          "description": "Location where the media is stored (local server or S3)."
        },

        "caption": {
          "type": "string",
          "description": "Caption for media messages."
        },

        "mime_type": {
          "type": "string",
          "description": "MIME type of the media."
        },

        "file_size": {
          "type": "integer",
          "description": "File size in bytes."
        },

        "location": {
          "type": "object",
          "description": "If content is a location.",
          "properties": {
            "lat": { "type": "number" },
            "lng": { "type": "number" },
            "name": { "type": "string" }
          }
        },

        "contact": {
          "type": "object",
          "description": "If content is a shared contact.",
          "properties": {
            "name": { "type": "string" },
            "phone": { "type": "string" }
          }
        }
      },
      "required": ["type"]
    },

    "reply_to": {
      "type": "string",
      "description": "ID of the message this one replies to (if any)."
    },

    "metadata": {
      "type": "object",
      "description": "Extra metadata from WhatsApp or your ingestion pipeline.",
      "properties": {
        "raw_source": {
          "type": "string",
          "description": "Optional raw payload from your extractor for debugging."
        },
        "received_at": {
          "type": "string",
          "format": "date-time",
          "description": "When the ingestion service received the message."
        },
        "ingestion_id": {
          "type": "string",
          "description": "Unique ID for this ingestion event."
        }
      }
    }
  },

  "required": [
    "id",
    "timestamp",
    "sender",
    "chat",
    "content"
  ],

  "additionalProperties": false
}

